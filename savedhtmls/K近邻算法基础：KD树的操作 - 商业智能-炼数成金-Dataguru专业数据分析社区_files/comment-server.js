STK.register("kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b,c){var d=a.core.util.language(b,$LANG);d=d.replace(/\\}/ig,"}");c&&(d=a.templet(d,c));return d}});
STK.register("kit.dom.parseDOM",function(a){return function(a){for(var b in a)a[b]&&a[b].length==1&&(a[b]=a[b][0]);return a}});
STK.register("kit.dom.firstChild",function(a){var b=a.core.dom.next;return function(a){var c=a.firstChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("common.listener",function(a){var b={},c={};c.define=function(c,d){if(b[c]!=null)throw"common.listener.define: 频道已被占用";b[c]=d;var e={};e.register=function(d,e){if(b[c]==null)throw"common.listener.define: 频道未定义";a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null)throw"commonlistener.define: 频道未定义";a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("common.channel.page",function(a){var b=["resize"];return a.common.listener.define("common.channel.page",b)});
typeof scope=="undefined"&&(scope={});scope.loginKit=function(){var a=document.cookie+";",b=["SUP","=([^;]*)?;"].join(""),c=["(\\?|&)","uid","=([^&]*)(&|$)"].join(""),d=a.match(new RegExp(b,"i"));d=d?d[1]||"":"";d=unescape(d);var e=d.match(new RegExp(c));e=e?e[2]||"":"";var f=scope.$oid;return{uid:e,isLogin:!!e,isAdmin:e&&f&&e==f}};scope.$isLogin=function(){return scope.loginKit().isLogin};scope.$isAdmin=function(){return scope.loginKit().isAdmin};
STK.register("common.editor.getLength",function(a){return function(b){var c=41,d=140,e=20,f=b,g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}});
STK.register("common.editor.flashContent",function(a){return function(a,b,c,d){b=b||["#fee","#fdd","#fcc","#fdd","#fee","transparent"];c=c||2;d=d||50;var e=0,f=b.length,g=c*f,h=setInterval(function(){a.style.backgroundColor=b[e%f];e++;e==g&&clearInterval(h)},d)}});
STK.register("kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i)))c=c.replace(d[1]+d[2]+d[3],"");return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++)c[b].indexOf(a+":")==0&&c.splice(b,1);return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("kit.dom.isTurnoff",function(a){return function(a){return!a.parentNode||a.parentNode.nodeType==11||!!a.disabled}});
STK.register("kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c)try{return a.selectionStart}catch(b){return 0}var d=c.createRange(),e,f,g=0,h=document.body.createTextRange();h.moveToElementText(a);for(g;h.compareEndPoints("StartToStart",d)<0;g++)h.moveStart("character",1);return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c)a.setSelectionRange(b,d);else{var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i)}else{var j=c.createRange();j.moveStart("character",-f);j.text=d}};b.replaceText=function(a,d){a.focus();var e=a.value,f=b.getSelectedText(a),g=f.length;if(f.length==0)b.insertText(a,d,b.getCursorPos(a));else{var h=b.getCursorPos(a);if(!c){var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStart=e.text.length-d.text.length;a.selectionEnd=a.selectionStart+d.text.length;b=a.selectionStart}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};b.getSelectedText=function(a){var b="",d=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=d(a):b=c.createRange().text;return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange(b,b+c)};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("module.at",function(a){var b=window,c=document,d=a.core.util.browser,e="font-family:Tahoma,宋体;",f=a.kit.extra.textareaUtils.selectionStart,g,h,i,j,k,l=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',e,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',e,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}(),m=function(){var b=[],c=g.textEl.style.cssText,d;a.foreach(["margin","padding","border"],function(c){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;c!="border"?e=b.push(c,"-",d.toLowerCase(),":",a.getStyle(g.textEl,c+d),";"):a.foreach(["Color","Style","Width"],function(e){b.push(c,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(g.textEl,[c,d,e].join("")),";")})})});b.push("font-size:"+a.getStyle(g.textEl,"fontSize")+";");return a.kit.dom.cssText([c,b.join(""),e,"word-wrap: break-word;line-height: 18px;overflow-y:auto;overflow-x:hidden;outline:none;"].join("")).getCss()},n=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list,e=b.wrap[0],f=b.flag[0],h=b.after[0],i=b.before[0],j=0,n,o,p,q=function(a){return d.MOZ?-2:d.MOBILE&&d.SAFARI&&(d.IPAD||d.ITOUCH||d.IPHONE)?-2:0};return{bind:function(){if(o!==g.textEl){k=a.position(g.textEl);var b=["left:",k.l,"px;top:",k.t+20,"px;"].join("");o=g.textEl;var d=m();o.style.cssText=d;p=[b,d,"position:absolute;filter:alpha(opacity=0);opacity:0;z-index:-1000;"].join("");e.style.cssText=p;if(!j){j=1;c.body.appendChild(e)}}},content:function(b,c,d,j){e.style.cssText=[p,"width:",(o.offsetWidth||parseInt(a.getStyle(o,"width")))+q(),"px;height:",o.offsetHeight||parseInt(a.getStyle(o,"height")),"px;overflow-x:hidden;overflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(o,"overflowY"),";"].join("");i.innerHTML=l(b);f.innerHTML=l(c)||"&thinsp;";h.innerHTML=l([d,j].join(""));clearTimeout(n);n=setTimeout(function(){var b=a.position(f);a.custEvent.fire(g.eId,"at",{t:b.t-o.scrollTop-k.t+5,l:b.l-k.l+5,key:d,flag:c,textarea:g.textEl})},30)},hide:function(){e.style.display="none"},show:function(){e.style.display=""}}}(),o=function(){if(a.kit.dom.isTurnoff(g.textEl))clearInterval(h);else{var b=g.textEl.value.replace(/\r/g,""),c=f(g.textEl);if(c<0||c==j)return;j=c;var d=b.slice(0,c),e=d.match(new RegExp(["(",g.flag,")([a-zA-Z0-9一-龥_]{0,20})$"].join("")));if(!e){a.custEvent.fire(g.eId,"hidden");return}var i=b.slice(c);d=d.slice(0,-e[0].length);n.content(d,e[1],e[2],i)}};return function(b){if(!!b&&!!b.textEl){b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!!g){clearInterval(h);a.removeEvent(g.textEl,"blur",c);n.hide()}},d=function(){c();g=b;j=null;n.bind();n.show();h=setInterval(o,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b.eId}}});
STK.register("kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}});
STK.register("core.str.trim",function(a){return function(a){if(typeof a!="string")throw"trim need a string as parameter";var b=a.length,c=0,d=/(\u3000|\s|\t|\u00A0)/;while(c<b){if(!d.test(a.charAt(c)))break;c+=1}while(b>c){if(!d.test(a.charAt(b-1)))break;b-=1}return a.slice(c,b)}});
STK.register("core.json.jsonToQuery",function(a){var b=function(b,c){b=b==null?"":b;b=a.core.str.trim(b.toString());return c?encodeURIComponent(b):b};return function(a,c){var d=[];if(typeof a=="object")for(var e in a){if(e==="$nullName"){d=d.concat(a[e]);continue}if(a[e]instanceof Array)for(var f=0,g=a[e].length;f<g;f++)d.push(e+"="+b(a[e][f],c));else typeof a[e]!="function"&&d.push(e+"="+b(a[e],c))}return d.length?d.join("&"):""}});
STK.register("common.log.monitor",function(a){var b="http://www.weibojs.com/log/widget.php",c={refer:document.referrer,title:document.title,ua:window.navigator.userAgent,os:window.navigator.platform+"|"+window.navigator.oscpu},d=!0,e=function(a){var b=new Image;d&&(b.src=a);b=null};return function(d){var f={},g=a.kit.extra.merge(c,d),h=[];for(var i in g){var j=g[i];typeof j=="object"&&(j=a.core.json.jsonToQuery(j));h.push(i+"="+encodeURIComponent(j))}var k=b+"?"+h.join("&");e(k);f.monitor=e;return f}});
STK.register("kit.io.ajax",function(a){return function(b){var c,d,e,f,g,h,i,j=function(b){a.common.log.monitor({url:document.location.protocol+"//"+document.location.hostname+(c.url.charAt(0)=="/"?c.url:"/"+c.url),param:c.args,method:c.method,result:b&&(b.code||0),httpcode:f.status})};h=function(a){g=!1;b.onComplete(a,c.args);setTimeout(k,0)};i=function(a){g=!1;b.onFail&&b.onFail(a,c.args);j(a);setTimeout(k,0)};e=[];f=null;g=!1;c=a.parseParam({url:"",method:"get",responseType:"json",timeout:3e4,onTraning:a.funcEmpty,isEncode:!0},b);c.onComplete=h;c.onFail=i;var k=function(){if(!!e.length){if(g===!0)return;g=!0;c.args=e.shift();f=a.ajax(c)}},l=function(a){while(e.length)e.shift();g=!1;if(f)try{f.abort()}catch(b){}f=null};d={};d.request=function(a){a||(a={});b.noQueue&&l();if(!b.uniqueRequest||!f){e.push(a);a._t=0;k()}};d.abort=l;return d}});
STK.register("kit.io.jsonp",function(a){return function(b){var c,d,e,f,g;c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:3e4,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:!0},b);e=[];f={};g=!1;var h=function(){if(!!e.length){if(g===!0)return;g=!0;f.args=e.shift();f.onComplete=function(a){g=!1;c.onComplete(a,f.args);setTimeout(h,0)};f.onFail=function(a){g=!1;c.onFail(a);setTimeout(h,0)};a.jsonp(a.kit.extra.merge(c,{args:f.args,onComplete:function(a){f.onComplete(a)},onFail:function(a){try{f.onFail(a)}catch(b){}}}))}};d={};d.request=function(a){a||(a={});e.push(a);a._t=1;h()};d.abort=function(a){while(e.length)e.shift();g=!1;f=null};return d}});
STK.register("kit.io.inter",function(a){return function(){var b,c,d;b={};c={};d={};b.register=function(a,b){if(c[a]!==undefined)throw a+" interface has been registered";c[a]=b;d[a]={}};b.hookComplete=function(b,c){var e=a.core.util.getUniqueKey();d[b][e]=c;return e};b.removeHook=function(a,b){d[a]&&d[a][b]&&delete d[a][b]};b.getTrans=function(b,e){var f=a.kit.extra.merge(c[b],e);f.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a.code==="100000")try{e.onSuccess(a,c)}catch(f){}else try{e.onError(a,c)}catch(f){}for(var g in d[b])try{d[b][g](a,c)}catch(f){}};return c[b].requestMode==="jsonp"?a.kit.io.jsonp(f):c[b].requestMode==="ijax"?a.kit.io.ijax(f):a.kit.io.ajax(f)};b.request=function(b,e,f){var g=a.core.json.merge(c[b],e);g.onComplete=function(a,c){try{e.onComplete(a,c)}catch(f){}if(a.code==="100000")try{e.onSuccess(a,c)}catch(f){}else try{if(a.code==="100002"){window.location.href=a.data;return}e.onError(a,c)}catch(f){}for(var g in d[b])try{d[b][g](a,c)}catch(f){}};g=a.core.obj.cut(g,["noqueue"]);g.args=f;return c[b].requestMode==="jsonp"?a.jsonp(g):c[b].requestMode==="ijax"?a.ijax(g):a.ajax(g)};return b}});
STK.register("common.trans.editor",function(a){var b=location.host=="widget.weibo.com"||location.host=="dev.weibo.com"?"":"/widget",c=a.kit.io.inter(),d=c.register;d("face",{url:b+"/public/aj_getemotions.php"});d("at",{url:b+"/public/aj_atusers.php"});return c});
STK.register("module.suggest",function(a){var b=null,c=a.custEvent,d=c.define,e=c.fire,f=c.add,g=a.addEvent,h=a.removeEvent,i=a.stopEvent,j=[],k={},l={ENTER:13,ESC:27,UP:38,DOWN:40,TAB:9},m=function(b){var c=-1,j=[],k=b.textNode,m=b.uiNode,n=a.core.evt.delegatedEvent(m),o=d(k,["open","close","indexChange","onSelect","onIndexChange","onClose","onOpen","openSetFlag"]);o.setFlag=p;var p=function(a){b.flag=a},q=function(){return a.sizzle(["[action-type=",b.actionType,"]"].join(""),m)},r=function(){c=-1;h(k,"keydown",s);n.destroy()},s=function(a){var d,f;if(!!(d=a)&&!!(f=d.keyCode)){if(f==l.ENTER){i();e(o,"onSelect",[c,k,b.flag]);return!1}if(f==l.UP){i();var g=q().length;c=c<1?g-1:c-1;e(o,"onIndexChange",[c]);return!1}if(f==l.DOWN){i();var g=q().length;c=c==g-1?0:c+1;e(o,"onIndexChange",[c]);return!1}if(f==l.ESC){i();r();e(o,"onClose");return!1}if(f==l.TAB){r();e(o,"onClose");return!1}}},t=function(c){e(o,"onSelect",[a.core.arr.indexOf(c.el,q()),k,b.flag])},u=function(b){c=a.core.arr.indexOf(b.el,q());e(o,"onIndexChange",[a.core.arr.indexOf(b.el,q())])};f(o,"open",function(a,c){k=c;r();g(c,"keydown",s);n.add(b.actionType,"mouseover",u);n.add(b.actionType,"click",t);e(o,"onOpen",[b.flag])});f(o,"openSetFlag",function(a,b){p(b)});f(o,"close",function(){r();e(o,"onClose",[b.flag])});f(o,"indexChange",function(a,d){c=d;e(o,"onIndexChange",[c,b.flag])});return o},n=function(b){var c=b.textNode,d=a.core.arr.indexOf(c,j);if(!k[d]){j[d=j.length]=c;k[d]=m(b)}return k[d]};return function(c){if(!!c.textNode&&!!c.uiNode){c=a.parseParam({textNode:b,uiNode:b,actionType:"item",actionData:"index",flag:""},c);return n(c)}}});
STK.register("common.channel.at",function(a){var b=["open","close"];return a.common.listener.define("common.channel.at",b)});
STK.register("kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c))throw"kit.dom.layerOutElement need element as first parameter";if(c===document.body)return!1;if(!c.parentNode)return!1;if(c.style.display==="none")return!1;var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f)return!1;while(f!==document.body){f=f.parentNode;if(f.style.display==="none")return!1;j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed")break;if(k==="true"&&j==="relative")break}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e.pos.split("-");i[0]==="left"?b.style.left=g.l+e.offsetX+"px":i[0]==="right"?b.style.left=g.l+h.w+e.offsetX+"px":i[0]==="center"&&(b.style.left=g.l+h.w/2+e.offsetX+"px");i[1]==="top"?b.style.top=g.t+e.offsetY+"px":i[1]==="bottom"?b.style.top=g.t+h.h+e.offsetY+"px":i[1]==="middle"&&(b.style.top=g.t+h.h/2+e.offsetY+"px");return!0}});
STK.register("common.editor.plugin.at",function(a){var b=a.kit.extra.language,c='<div class="WB_tips_smart WB_email"><p class="tipsmt_title" node-type="suggestTitle">想用@提到谁</p><ul class="tipsmt_list" node-type="suggestWrap"></ul></div>',d={"@":{normalTitle:b("#L{选择昵称或轻敲空格完成输入}"),moreTitle:b("#L{选择最近@的人或直接输入}"),noTilte:b("#L{轻敲空格完成输入}")},"#":{normal:b("#L{想用什么话题？}")}},e={"@":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="tipsmt_cur" </#if>action-data="value=${list.nickname}" value="${list.nickname}"><a href="#">${list.nickname}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'},f,g,h,i,j,k,l,m=!1,n,o,p={"@":"at","#":"topicList"},q=0,r=function(){setTimeout(function(){a.custEvent.fire(f,"close")},200)},s=function(){k.style.display="none"},t=function(){a.custEvent.add(f,"onIndexChange",function(a,b){y(b)});a.custEvent.add(f,"onSelect",function(b,c,d,e){q=0;a.core.evt.stopEvent();var g=o[c].getAttribute("value");g=g.replace(/\(.*\)/,"");try{d.focus()}catch(h){}var i=a.kit.extra.textareaUtils.selectionStart(d)*1,j=new RegExp(e+"([a-zA-Z0-9一-龥_]{0,20})$"),k=d.value.replace(/\r+/g,"").slice(0,i).match(j),l=d.value.slice(i,i+1);k=k&&k[1]?k[1].length:0;var m=a.kit.extra.textareaUtils;e=="#"?typeof l!="undefined"&&l!=e&&(g=g+e+" "):g=g+" ";m.insertText(d,g,i,k);var n=m.getCursorPos(d);if(e=="#"&&l==e){m.setCursor(d,n+1);m.insertText(d," ",n+1,0)}n=m.getCursorPos(d);var p=m.getSelectedText(d),r=p==""||p==null?0:p.length;d.setAttribute("range",n+"&"+r);a.custEvent.fire(f,"close")});a.addEvent(h.textEl,"blur",r);a.custEvent.add(f,"onClose",s);a.custEvent.add(f,"onOpen",function(b,c){j.style.display="";k.style.display="";m=!0;setTimeout(function(){a.custEvent.fire(f,"indexChange",0)},100)})},u=function(b,c,f){b=="@"?c.data&&c.data.length>0?c.title=f==""?d[b].moreTitle:d[b].normalTitle:c.title=d[b].noTilte:c.title=d[b].normalTitle;var g=a.core.util.easyTemplate(e[b],c);return g},v=function(){a.core.evt.custEvent.add(g,"hidden",function(b,c){a.custEvent.fire(f,"close")});a.core.evt.custEvent.add(g,"at",function(b,c){l=c.key;var e=c.flag;if(l.length==0&&e!="@")a.custEvent.fire(f,"close");else{var g=document.location.host=="widget.weibo.com"?"":"/widget";a.core.io.ajax({url:g+"/public/aj_atusers.php",args:{wsrc:$CONFIG.wsrc||"app_comment_box",appkey:$CONFIG.source_appkey||$CONFIG.appkey||$CONFIG.app_src,q:l},onComplete:function(b){if(b.code=="100000"){var g=u(e,b,l);a.custEvent.fire(f,"openSetFlag",e);a.custEvent.fire(f,"open",c.textarea);var h=a.core.dom.builder(g),m=h.box;j.innerHTML=m;j.style.display=b.data.length==0?"none":"";i.innerHTML=l.length==0?d["@"].moreTitle:d["@"].normalTitle;k.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");a.common.channel.at.fire("open");a.kit.dom.layoutPos(k,c.textarea,{pos:"left-top",offsetX:c.l,offsetY:c.t})}else a.custEvent.fire(f,"close")},onFail:function(){a.custEvent.fire(f,"close")}})}})},w=function(){n=h.textEl;g=STK.module.at({textEl:n,flag:"@"})},x=function(b){q=0;k&&(k.style.display="none");k&&(k.innerHTML="");var d=a.builder(c);k=a.kit.dom.firstChild(d.box);k.style.display="none";document.body.appendChild(k);i=d.list.suggestTitle[0];j=d.list.suggestWrap[0];f&&a.custEvent.fire(f,"close");f&&a.custEvent.remove(f);f=a.module.suggest({textNode:b,uiNode:j,actionType:"item",actionData:"value",flag:"@"});t()},y=function(b){o=a.sizzle("li",j);o&&o[0]&&a.core.dom.removeClassName(o[q],"tipsmt_cur");a.core.dom.addClassName(o[b],"tipsmt_cur");q=b};return function(a,b){h=a.nodeList;var c={};c.init=function(){w();x(h.textEl);v()};return c}});
STK.register("common.editor.simpleEditor",function(a){var b=a.core.str.trim,c,d=a.common.editor.getLength,e=function(a,b){var c=d(a),e=Math.abs(b-c),f;c>b||c<1?f={wordsnum:c,vnum:e,overflow:!0}:c==0?f={wordsnum:c,vnum:e,overflow:!0}:f={wordsnum:c,vnum:e,overflow:!1};return f};return function(d,f){f=f||{};var g=f.limit||140;if(!d)throw"[easyEditor]: editor is null";a.custEvent.define(d,"textNum");a.custEvent.define(d,"keyUpCount");var h=a.sizzle('[node-type="editor"]',d)[0],i=a.sizzle('[node-type="wordNum"]',d)[0];if(f.atSwitch!=null&&f.atSwitch==!0){var j=a.common.editor.plugin.at({nodeList:{textEl:h}},f);j.init()}a.addEvent(h,"focus",function(){c=setInterval(function(){k()},200)});a.addEvent(h,"blur",function(){c&&clearInterval(c)});var k=function(){var c=b(h.value).length==0?b(h.value):h.value;c=c.replace(/\r\n/g,"\n");var j=e(c,g);c.length>=0&&h.focus?j.overflow&&j.wordsnum!=0?i.className=f.warnClassName?f.warnClassName:"WB_tipS_numWarn":i.className=f.className?f.className:"WB_tipS_num":c.length===0&&(i.className=f.className?f.className:"WB_tipS_num");c.length!==0&&j.overflow?i.innerHTML="-"+(j.vnum>100?"n":j.vnum):i.innerHTML=j.vnum;a.custEvent.fire(d,"textNum",{count:j.wordsnum,isOver:j.overflow})};a.addEvent(h,"keyup",k);a.custEvent.add(d,"keyUpCount",k);k()}});
STK.register("common.trans.comment",function(a){var b=location.host!="widget.weibo.com"?"/widget":"",c=a.kit.io.inter(),d=c.register;d("publisher",{url:"/distribution/aj_commentbox.php",method:"post"});d("getuserinfo",{url:"/distribution/aj_isopent.php",method:"get"});d("comment",{url:"/distribution/aj_addcomment.php",method:"post"});d("reply",{url:"/distribution/aj_addcomment.php",method:"post"});d("loadmore",{url:"/distribution/aj_getcomments.php",method:"get"});d("face",{url:b+"/public/aj_getemotions.php",method:"get"});d("blockuser",{url:"/distribution/aj_blackuid.php",method:"post"});d("blockcomment",{url:"/distribution/aj_blackcmtid.php",method:"post"});d("commentlist",{url:"/distribution/aj_getsecondcomments.php",method:"get"});d("message",{url:"/distribution/aj_message.php",method:"post"});d("getmsg",{url:"/distribution/aj_message.php",method:"get"});return c});
STK.register("kit.extra.count",function(a){function b(b){var c=41,d=140,e=20,f=b,g=b.match(/http:\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return num=b(a)}});
STK.register("module.editor",function(a){var b=a.core.evt.addEvent,c=a.core.evt.custEvent,d=a.core.dom.getStyle,e=a.core.dom.setStyle;return function(b,c){var d={},c=c,e={},f={reset:function(){e.textEl.value="";a.core.evt.custEvent.fire(d,"changed");e.textEl.removeAttribute("extra")},delWords:function(a){var b=f.getWords();if(!(b.indexOf(a)>-1))return!1;e.textEl.value="";h.textInput(b.replace(a,""))},getWords:function(){return a.core.str.trim(e.textEl.value)},getExtra:function(){var b,c=e.textEl.getAttribute("extra")||"";c!=null&&(b=a.core.str.trim(c));return b},focus:function(b,c){if(typeof b!="undefined")a.kit.extra.textareaUtils.setCursor(e.textEl,b,c);else{var d=e.textEl.value.length;a.kit.extra.textareaUtils.setCursor(e.textEl,d)}g.cacheCurPos()},blur:function(){e.textEl.blur()},addExtraInfo:function(a){typeof a=="string"&&e.textEl.setAttribute("extra",a)},disableEditor:function(a){a===!0?e.textEl.setAttribute("disabled","disabled"):e.textEl.removeAttribute("disabled")},getCurPos:function(){var a=e.textEl.getAttribute("range")||"0&0";return a.split("&")},count:function(){var b=a.core.str.trim(e.textEl.value).length==0?a.core.str.trim(e.textEl.value):e.textEl.value;return a.kit.extra.count(b)}},g={textElFocus:function(){e.recommendTopic&&a.core.dom.setStyle(e.recommendTopic,"display","none");a.custEvent.fire(d,"focus");e.num&&a.core.dom.setStyle(e.num,"display","block");f.getWords()==c.tipText&&f.delWords(c.tipText)},textElBlur:function(){setTimeout(function(){if(e.textEl.value.length===0){e.recommendTopic&&a.core.dom.setStyle(e.recommendTopic,"display","block");e.num&&e.recommendTopic&&a.core.dom.setStyle(e.num,"display","none");a.custEvent.fire(d,"blur");typeof c.tipText!="undefined"&&(e.textEl.value=c.tipText)}},50)},cacheCurPos:function(){var b=a.kit.extra.textareaUtils.getSelectedText(e.textEl),c=b==""||b==null?0:b.length,d=a.kit.extra.textareaUtils.getCursorPos(e.textEl),f=d+"&"+c;e.textEl.setAttribute("range",f)}},h={textChanged:function(){a.custEvent.fire(d,"keyUpCount")},textInput:function(b,h){var i=f.getCurPos(),h=i[0],j=i[1];f.getWords()==c.tipText&&b!=c.tipText&&f.delWords(c.tipText);a.kit.extra.textareaUtils.unCoverInsertText(e.textEl,b,{rcs:i[0],rccl:i[1]});g.cacheCurPos();a.core.evt.custEvent.fire(d,"changed")}},i={},j=function(){m();n()},k=function(){o();q();r();l()},l=function(){c.storeWords?e.textEl.value.length==0&&h.textInput(c.storeWords):c.tipText&&(e.textEl.value=c.tipText)},m=function(){if(!b)throw"node is not defined in module editor"},n=function(){var c=a.core.dom.builder(b).list;e=a.kit.dom.parseDOM(c)},o=function(){a.core.evt.addEvent(e.textEl,"focus",g.textElFocus);a.core.evt.addEvent(e.textEl,"blur",g.textElBlur);a.core.evt.addEvent(e.textEl,"mouseup",g.cacheCurPos);a.core.evt.addEvent(e.textEl,"keyup",g.cacheCurPos)},p=function(){a.core.evt.custEvent.define(d,"changed")},q=function(){p();a.core.evt.custEvent.add(d,"changed",h.textChanged)},r=function(){},s=function(){};j();var t={reset:f.reset,getWords:f.getWords,getExtra:f.getExtra,delWords:f.delWords,focus:f.focus,blur:f.blur,insertText:h.textInput,check:h.textChanged,addExtraInfo:f.addExtraInfo,disableEditor:f.disableEditor,getCurPos:f.getCurPos,count:f.count};d.destroy=s;d.API=t;d.nodeList=e;d.init=k;d.opts=c;return d}});
STK.register("common.editor.plugin.count",function(a){function e(a,b){if(!a.textEl)throw"[editor plugin count]: plz check nodeList"}function d(a){var d=c(a),e=Math.abs(b-d),f;d>b||d<1?f={wordsnum:d,vnum:e,overflow:!0}:d==0?f={wordsnum:d,vnum:e,overflow:!0}:f={wordsnum:d,vnum:e,overflow:!1};return f}function c(b){var c=41,d=140,e=20,f=b,g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}var b;return function(c){var f=c.nodeList,g,h=c.opts,i=a.kit.extra.language;b=h.limitNum;e(f);a.custEvent.define(c,"textNum");a.custEvent.define(c,"keyUpCount");var j=f.textEl,k=f.num;a.addEvent(j,"focus",function(){g=setInterval(function(){l()},200)});a.addEvent(j,"blur",function(){clearInterval(g)});var l=function(){var b=a.core.str.trim(j.value).length==0?a.core.str.trim(j.value):j.value,e=c&&c.opts&&c.opts.extendText;b=b.replace(/\r\n/g,"\n");var f=d(b,h.limitNum);b.length>=0&&j.focus?f.overflow&&f.wordsnum!=0?k.innerHTML=(e?i(e):"")+i("#L{已经超过}")+'<span class="W_error">'+f.vnum+"</span>字":k.innerHTML=(e?i(e):"")+i("#L{还可以输入}")+"<span>"+f.vnum+"</span>字":b.length===0&&(k.innerHTML=(e?i(e):"")+i("#L{还可以输入}")+"<span>"+f.vnum+"</span>字");a.core.evt.custEvent.fire(c,"textNum",{count:f.wordsnum,isOver:f.overflow})};STK.core.evt.addEvent(j,"keyup",l);a.custEvent.add(c,"keyUpCount",l)}});
STK.register("common.editor.base",function(a){var b={limitNum:140};return function(c,d){var e={},f,g,h,i;f=a.kit.extra.merge(b,d);g=a.module.editor(c,f);h=g.nodeList;i=[];if(typeof d.count=="undefined"||d.count=="enable")var j=a.common.editor.plugin.count(g,f);if(f.atSwitch!=null&&f.atSwitch==!0){var k=a.common.editor.plugin.at(g,f);k.init()}g.init();g.widget=function(a,b,c){i.push(a);a.init(g,b,c);return g};g.closeWidget=function(){if(i&&i.length!=0)for(var a=0,b=i.length;a<b;a++)i[a].hide()};return g}});
STK.register("common.editor.plugin.faceSimple",function(a){var b=a.common.trans.comment,c='<div class="WB_tips_show" style="display:none; z-index:10000;" node-type="faceOuter"><span class="ts_arr"></span><div class="layer_faces"><a href="javascript:;" node-type="close" class="WB_tips_show_close">关闭</a><div class="tipsshow_detail" node-type="inner"></div></div></div></div>',d='<#et temp data><ul class="faces_list clearfix"><#list data as list><li action-type="expression" action-data="text=${list.value}"><img alt="${list.phrase}" title="${list.phrase.replace("[", "").replace("]", "")}" src="${list.url}" /></li></#list></ul></#et>',e='<p class="none"><img src="http://timg.sjs.sinajs.cn/t35/appstyle/opent/images/widgets/common/loading.gif" alt="" class="loading" />正在加载，请稍候....</p>',f={};return function(g,h){n=g;var i={},j,k,l,m,n,o,p,q,r=a.parseParam({outer:null,url:"",container:document.body},h);a.custEvent.define(i,"insert");var s=function(){var b=a.builder(c);j=b.list.faceOuter[0];k=b.list.inner[0];l=b.list.close[0];r.container.appendChild(j);t()},t=function(){m=a.delegatedEvent(j);m.add("expression","click",function(b){a.custEvent.fire(i,"insert",{text:b.data.text})});a.addEvent(l,"click",i.hide);a.addEvent(document.body,"click",function(b){var c=a.fixEvent(b);a.contains(j,c.target)||i.hide()});a.addEvent(n,"click",function(b){a.stopEvent();y(g,r)})},u=function(){k.innerHTML=e},v=function(c){var d=a.parseParam({type:"face",language:"cnname"},c);u();if(f.status)x(f.data,f.status);else{var e=b.getTrans("face",{onComplete:function(a){if(a.code==="100000"){x(a.data.usual.norm,a.code);f.status=a.code;f.data=a.data.usual.norm}}});e.request({wsrc:$CONFIG.wsrc||"app_comment_box",appkey:scope.appkey,type:"face"})}},w=function(a,b){b=b||"common";var c=[];for(var d=0,e=a.length;d<e;d++){var f=a[d];f[b]&&c.push(f)}return c},x=function(b,c){var e=w(b),f=a.core.util.easyTemplate(d,e);k.innerHTML=f;a.kit.dom.layoutPos(j,n,{pos:"left-bottom",offsetX:-9,offsetY:5})},y=function(b,c){q||(q=a.sizzle("[node-type=imgOuter]",r.container)[0]);q&&(q.style.display="none");j.style.display="";v()};i.show=y;i.hide=function(){j.style.display="none"};s();return i}});
STK.register("common.editor.plugin.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c)return a.selectionStart;var b=c.createRange(),d,e,f=0,g=document.body.createTextRange();g.moveToElementText(a);for(f;g.compareEndPoints("StartToStart",b)<0;f++)g.moveStart("character",1);return f};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c)a.setSelectionRange(b,d);else{var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i)}else{var j=c.createRange();j.moveStart("character",-f);j.text=d}};b.replaceText=function(a,d){a.focus();var e=a.value,f=b.getSelectedText(a),g=f.length;if(f.length==0)b.insertText(a,d,b.getCursorPos(a));else{var h=b.getCursorPos(a);if(!c){var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStart=e.text.length-d.text.length;a.selectionEnd=a.selectionStart+d.text.length;b=a.selectionStart}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};b.getSelectedText=function(a){var b="",d=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=d(a):b=c.createRange().text;return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange(b,b+c)};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("comp.widget.comment.editor",function(a){var b=a.kit.extra.language,c=a.common.editor.plugin.textareaUtils;return function(d,e){e=e||{};var f={},g,h,i={limitNum:140,tipText:b("#L{顺便说点什么吧……}"),count:"disable"},j,k=function(){h.tips.style.display="";setTimeout(function(){h.tips.style.display="none"},2e3)},l=function(){m();n()},m=function(){var b;g=a.common.editor.base(d,i);h=g.nodeList;f.doms=h;var e=a.common.editor.plugin.faceSimple(h.face,{outer:d});a.custEvent.add(e,"insert",function(a,b){h.textEl.value==i.tipText&&(h.textEl.value="");c.insertText(h.textEl,b.text,c.getCursorPos(h.textEl));e.hide()});a.addEvent(h.textEl,"focus",function(){b=setInterval(function(){n()},200);h.container.className="WB_textarea_auto WB_textarea_foucs"});a.addEvent(h.textEl,"blur",function(){clearInterval(b);h.container.className="WB_textarea_auto"});var j=a.core.util.storage.get("publish_word");j!=null&&j!=""&&j!="null"&&(h.textEl.value=j);n()},n=function(){h.sendBtn.title==b("#L{发私信}")&&(i.limitNum=300);var c=g.API.count();a.trim(h.textEl.value)==b(i.tipText)?c=0:e.saveword&&a.core.util.storage.set("publish_word",a.trim(h.textEl.value));var d;c==0?d=!1:c>(h.sendBtn.title==b("#L{发私信}")?300:140)?d=!1:d=!0;if(j!=d){var f=h.sendBtn.title==b("#L{回复}")?"WB_btn_reply"+b(" #L{WB_cn}"):h.sendBtn.title==b("#L{评论}")?"WB_btn_comment"+b(" #L{WB_cn}"):"WB_btn_send"+b(" #L{WB_cn}");h.sendBtn.className=d?f:f.replace(b(" #L{WB_cn}"),"")+"_dis"+b(" #L{WB_cn}")}j=d;var k=i.limitNum-c,l=k>=0?!0:!1;if(l){h.wordNum.innerHTML=k;h.wordNum.className="WB_num"}else{h.wordNum.innerHTML=k;!j&&(h.wordNum.className="WB_num WB_numErr")}},o=function(){};f.getValue=function(){return a.trim(h.textEl.value)};f.setBtnStatus=function(a,b){h.sendBtn.className=b;h.sendBtn.innerHTML=a};f.isSendWB=function(){return h.sendWB.checked?1:0};f.showError=function(a){a=a||b("#L{评论失败，请重试！}");h.tips.innerHTML='<span class="WB_tipB_err"></span><span class="WB_icon_txt">'+a+"</span>";k();var c=h.sendBtn.title==b("#L{回复}")?"WB_btn_reply"+b(" #L{WB_cn}"):h.sendBtn.title==b("#L{评论}")?"WB_btn_comment"+b(" #L{WB_cn}"):"WB_btn_send"+b(" #L{WB_cn}");f.setBtnStatus(b("#L{不可评论}"),c)};f.showSuccess=function(a){h.textEl.value="";a=a||b("#L{评论成功！}");h.tips.innerHTML='<span class="WB_tipB_ok"></span><span class="WB_icon_txt">'+a+"</span>";k();var c=h.sendBtn.title==b("#L{回复}")?"WB_btn_reply"+b(" #L{WB_cn}"):h.sendBtn.title==b("#L{评论}")?"WB_btn_comment"+b(" #L{WB_cn}"):"WB_btn_send"+b(" #L{WB_cn}");f.setBtnStatus(b("#L{不可评论}"),c.replace(b(" #L{WB_cn}"),"")+"_dis"+b(" #L{WB_cn}"))};l();f.destroy=o;f.editor=g;return f}});
STK.register("common.widget.showEditor",function(a){var b=a.kit.extra.language,c=a.addEvent,d=a.common.editor.getLength,e=a.common.editor.flashContent,f=a.removeEvent,g={type:"repost",template:'<#et temp data><div class="pub_area clearfix"><div class="wbavatar"><img src="${data.upic}" alt="${data.uname}" title="${data.uname}" /></div><div class="wb_cmR wbPubbox"><div class="wb_counter">#L{还可以输入}<em class="WB_num" node-type="wordNum">140</em>#L{字}</div><div class="WB_textarea_auto WB_textarea_foucs"><div class="WB_send_stat" node-type="tips" style="display:none;"></div><textarea class="textarea_inner" node-type="textEl">${data.text}</textarea></div><div class="WB_pubBoxPlus clearfix"><div class="WB_Plus_zone clearfix"><a href="#" onclick="return false;" node-type="face" class="WB_Aemoticons"><span class="WB_icon"></span><span class="WB_icon_txt">#L{表情}</span></a><span class="WB_wordPlus"><label><input type="checkbox" class="WB_checkbox" node-type="sendWB" checked="checked" />#L{同步到微博}</label></span></div><div class="WB_Plus_btn"><a href="#" onclick="return false;" title="#L{回复}" class="WB_btn_reply #L{WB_cn}" node-type="sendBtn">#L{回复}</a></div></div></div></div></#et>',forward:"",uname:"",callback:function(){}};return function(h,i){var j,k,l,m={},n="";g=a.parseParam(g,i);if(h&&typeof h=="string")h=a.E(h);else if(h.nodeType!==1)throw"[common.widget.showEditor] node.nodeType wrong!";var o={text:""};if(g.type==="repost"){g.uname=decodeURIComponent(g.uname);var p=g.forward?"//@"+g.uname+"："+decodeURIComponent(g.forward||""):"";o.text=p}var q=function(){var b=a.trim(l.editor.value),c=d(b);if(c>140||c===0){e(l.editor);return!1}var f=l.check.checked;typeof g.callback=="function"&&g.callback.call(m,b,f)},r=function(){t();u();s()},s=function(){h.parentNode.appendChild(k.box);l.outer.style.display="block";a.kit.extra.textareaUtils.setCursor(l.editor,0,0);a.common.editor.simpleEditor(l.publisher,{warnClassName:"txt_num err_num",className:"txt_num"})},t=function(){j=a.core.util.easyTemplate(b(g.template),o).toString();k=a.core.dom.builder(j);l=a.kit.dom.parseDOM(k.list)},u=function(){if(g.type==="comment"){l.more.innerHTML=b("#L{同时转发}");l.sendBtn.innerHTML=b("<span>#L{评论}</span>")}c(l.back,"click",v);c(l.sendBtn,"click",q);a.core.evt.hotKey.add(l.editor,"ctrl+Enter",q)},v=function(){l.error.style.display="none";l.editor.value=n};m.showError=function(a){a&&(l.tip_error.innerHTML=a);l.error.style.display="";n=l.editor.value;l.editor.value="";setTimeout(function(){l&&(l.error.style.display="none")},3e3)};m.clear=function(){n="";l.editor.value=""};m.showSuccess=function(a){a&&(l.tip_success.innerHTML=a);m.clear();l.success.style.display="";setTimeout(function(){l&&(l.success.style.display="none")},3e3)};m.setArrow=function(a){l.arrow.style.marginRight=a+"px"};m.getNodes=function(){return l};m.show=s;m.hide=function(a){l.outer.style.display="none";a&&this.destroy()};m.destroy=function(){f(l.back,"click",v);f(l.sendBtn,"click",q);a.core.evt.hotKey.remove(l.editor,"ctrl+Enter",q);a.removeNode(l.outer);for(var b in l)l[b]=null;l=null};r();return m}});
STK.register("kit.dom.parentElementBy",function(a){return function(a,b,c){if(!a||!b)throw new Error("传入的参数为空");var d=0,e;a=a.parentNode;while(a.parentNode){d++;e=c(a);if(e===!1)return!1;if(e===!0)return a;if(e===b)return null;a=a.parentNode;if(d>3e4)return!1}return null}});
STK.register("kit.dom.lastChild",function(a){var b=a.core.dom.prev;return function(a){var c=a.lastChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("core.obj.parseParam",function(a){return function(a,b,c){var d,e={};b=b||{};for(d in a){e[d]=a[d];b[d]!=null&&(c?a.hasOwnProperty[d]&&(e[d]=b[d]):e[d]=b[d])}return e}});
STK.register("common.widget.log",function(a){var b={app_sharebutton:1,app_followbutton:2,app_livestream:4,app_listweibo:5,app_weiboshow:6,app_commentbox:7};return function(c){var d=a.core.obj.parseParam({vsrc:"app_weiboshow",refer:"",step:1},c),e=scope.refer||scope.$refer||d.refer,f=scope.loginKit().uid||"",g=scope.appkey||$CONFIG.$appkey||$CONFIG.appkey||0,h=b[d.vsrc]||"",i="http://rs.sinajs.cn/r.gif?uid="+f+"&appid="+g+"&refer="+e+"&cat="+h+"&step="+d.step+"&rnd="+ +(new Date),j=new Image;j.src=i;j=null}});
STK.register("common.widget.login",function(a){var b={vsrc:"app_weiboshow",appsrc:"",showlogo:0,callback:function(){}};typeof App=="undefined"&&(App={});return function(c){c=a.parseParam(b,c);c.appsrc||(c.appsrc=scope?scope.appsrc?scope.appsrc:scope.$appsrc?scope.$appsrc:"":"");var d={};App.loginBackUrlCallBack=function(b){a.custEvent.fire(d,"login",b);c.step=2;a.common.widget.log(c)};var e=function(){f();g();h();i()},f=function(){},g=function(){},h=function(){a.custEvent.define(d,"login")},i=function(){a.custEvent.add(d,"login",function(a){c.callback(a)})};d.showLogin=function(){var b="&"+a.jsonToQuery(c),d="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html"+b+"&rnd="+ +(new Date).valueOf();/weibo.com/.test(location.host)&&(d=d.replace(/\/widget/,""));var e=window.open(d,"miniblog_login",["toolbar=1,status=0,resizable=1,width=620,height=540,left=",(screen.width-620)/2,",top=",(screen.height-450)/2].join(""));e.focus();a.common.widget.log(c)};e();return d}});
STK.register("comp.widget.comment.resize",function(a){return function(){var b={page:{width:document.body.clientWidth,height:document.body.clientHeight}};b=a.jsonToQuery(b.page);a.common.channel.page.fire("resize",b)}});
STK.register("comp.widget.comment.reply",function(a){function J(c){var d=e.getTrans("blockcomment",{onComplete:function(d){if(d.code==="A00006"){var e=a.kit.dom.parentElementBy(c.el,document.body,function(a){if(a.tagName.toLowerCase()=="div"&&a.className=="wc_list_nod clearfix wc_disable")return!0});H(!1,c.el);c.el.innerHTML=b("#L{取消屏蔽}");c.el.setAttribute("action-type","huifu");c.el.setAttribute("action-data","id="+c.data.id)}}});d.request({appkey:scope.appkey,id:c.data.id||"",action:c.data.action||"add",short_url:scope.short_url||"",since_id:scope.since_id||"",refer:scope.refer})}function I(c){var d=e.getTrans("blockcomment",{onComplete:function(d){if(d.code==="A00006"){var e=a.kit.dom.parentElementBy(c.el,document.body,function(a){if(a.tagName.toLowerCase()=="div"&&a.className=="wc_list_nod clearfix wc_disable")return!0});H(!0,c.el);c.el.innerHTML=b("#L{屏蔽}");c.el.setAttribute("action-type","pingbi");c.el.setAttribute("action-data","id="+c.data.id+"&action=add")}}});d.request({appkey:scope.appkey,id:c.data.id||"",action:c.data.action||"del",short_url:scope.short_url||"",since_id:scope.since_id||"",refer:scope.refer})}function H(b,c){var d=a.kit.dom.parentElementBy(c,document.body,function(a){if(a.tagName.toLowerCase()=="div"&&a.className.indexOf("wc_list_nod clearfix")!=-1)return!0});d&&d.className!="wc_list_nod clearfix wc_disable"&&(d.className="wc_list_nod clearfix"+(b?"":" wc_disableC"));d.setAttribute("hide_comment",b?"":"1")}function G(c,d){var e;if(t==null){var f=s.childNodes;for(var g=0,h=f.length;g<h;g++){var i=f[g];i.nodeType==1&&i.tagName.toLowerCase()=="div"&&i.className=="wc_list"&&(t=i)}}if(a.isNode(t)){f=a.sizzle(".wc_list_nod",t);for(g=0,h=f.length;g<h;g++){i=f[g];if(i.nodeType==1&&i.tagName.toLowerCase()=="div"&&i.getAttribute("uid")==d){i.className="wc_list_nod clearfix"+(c?i.getAttribute("hide_comment")=="1"?" wc_disableC":"":" wc_disable");i.setAttribute("hide_user",c?"":"1");c?e=a.sizzle('a[action-type="quxiao"]',i):e=a.sizzle('a[action-type="jinyan"]',i);e.length>0&&(e=e[0]);if(c){e.setAttribute("action-type","jinyan");e.setAttribute("action-data","id="+d+"&action=add");e.innerHTML=b("#L{禁言}")}else{e.setAttribute("action-type","quxiao");e.setAttribute("action-data","id="+d);e.innerHTML=b("#L{取消禁言}")}}}}}function F(c){var d=e.getTrans("blockuser",{onComplete:function(d){if(d.code==="A00006"){G(!0,c.data.id);var e=c.el;if(c.el.tagName.toLowerCase()!="a"){var f=a.sizzle('a[action-type="quxiao"]',e.parentNode.parentNode);f.length>0&&(e=f[0])}e.className!="unableIcon"&&(e.innerHTML=b("#L{禁言}"));e.setAttribute("action-type","jinyan");e.setAttribute("action-data","id="+c.data.id+"&action=add")}}});d.request({appkey:scope.appkey,id:c.data.id||"",action:c.data.action||"del",refer:scope.refer})}function E(a){var c=e.getTrans("blockuser",{onComplete:function(c){if(c.code==="A00006"){G(!1,a.data.id);a.el.innerHTML=b("#L{取消禁言}");a.el.setAttribute("action-type","quxiao");a.el.setAttribute("action-data","id="+a.data.id)}}});c.request({appkey:scope.appkey,id:a.data.id||"",action:a.data.action||"add",refer:scope.refer})}function D(b){var c=a.kit.dom.parentElementBy(b.el,document.body,function(a){if(a.tagName.toLowerCase()=="blockquote")return!0});z(c,b.data,function(){})}function C(a,c){var d=B(a);c=c||b("#L{回复}@"+d+":");q[a.data.cid].API.reset();q[a.data.cid].API.insertText(c);q[a.data.cid].API.focus()}function B(b){var c=b.el,d="";c=a.kit.dom.parentElementBy(c,document.body,function(a){if(a.tagName.toLowerCase()=="div"&&a.className=="wb_cmR comm_main")return!0});c=a.sizzle('a[class="user_name"]',c);c.length>0&&(c=c[0]);a.isNode(c)&&(d=c.innerHTML);return d}function A(b){var c=b.el,d="";c=a.kit.dom.parentElementBy(c,document.body,function(a){if(a.tagName.toLowerCase()=="div"&&a.className=="wb_cmR comm_main")return!0});c=a.sizzle('a[class="rl_link"]',c);c.length>0&&(c=c[0]);return c}function z(b,c,d){var f=e.getTrans("commentlist",{onComplete:function(c){var e,f;if(b&&typeof b.tagName!="undefined"){e=a.sizzle('div[class="wc_list child_list"]',b);e=e.length>0?e[0]:null}var g=a.sizzle("div[isreal=false]",b.parentNode);for(var h=0,i=g.length;h<i;h++)a.removeNode(g[h]);if(c.code=="A00006")if(e){f=a.C("BUFFER");f.innerHTML="<div>json.html</div>";var j=e.parentNode;a.removeNode(e);a.insertHTML(j,c.html,"beforeend")}else a.insertHTML(b,c.html,"beforeend");else if(e){f=a.C("BUFFER");f.innerHTML=n;a.replaceNode(e,f)}else a.insertHTML(b,n,"beforeend");typeof d=="function"&&d();a.comp.widget.comment.resize()}}),g={srcuid:c.srcuid||"",cid:c.cid||"",page:c.page||"",short_url:scope.short_url||"",appkey:scope.appkey||"",language:scope.language||""};f.request(g)}function y(b){var d=b.el,e=d.parentNode,f,g,h=e.getAttribute("show"),i="";if(h){e.removeAttribute("show");a.removeNode(a.sizzle("blockquote.commReply",e.parentNode)[0]);if(q&&q[b.data.cid]){q[b.data.cid].desotry&&q[b.data.cid].desotry();delete q[b.data.cid]}var j=a.sizzle("div[isreal=false]",d.parentNode.parentNode);for(var n=0,o=j.length;n<o;n++)a.removeNode(j[n]);a.comp.widget.comment.resize();if(h==1)return}e.setAttribute("show",1);v=A(b);var s=b.data.mid+"_"+b.data.cid;r[s]={};r[s].data=a.core.json.clone(b.data);r[s].el=b.el;var t=a.C("span");t.className="WB_loadingMini";e.appendChild(t);var u={uid:b.data.uid||"",page:p||"1",short_url:scope.short_url||"",cid:b.data.cid||"",appkey:scope.appkey||"",language:scope.language||"zh_cn"},w=a.C("blockquote"),y=a.builder(m.replace(/###data###/g,"mid="+b.data.mid+"&cid="+b.data.cid)),B;g=y.list.outer[0];w.className="commReply";if(!scope.loginKit().isLogin){B=a.builder(k);f=B.list.loginOuter[0];w.appendChild(f)}else if(scope.$passport!=""){B=a.builder(l);f=B.list.loginOuter[0];w.appendChild(f)}w.appendChild(g);a.insertAfter(w,e);c=a.comp.widget.comment.editor(y.list.publisher[0],{saveword:!1});q[b.data.cid]=c.editor;q[b.data.cid].editor=c;C(b,i);a.core.evt.hotKey.add(c.doms.textEl,"ctrl+Enter",x);var j=a.sizzle("div[isreal=false]",d.parentNode.parentNode);j.length==0&&(g.style.borderBottom="none");a.comp.widget.comment.resize();var D=a.core.util.pageSize();a.core.util.scrollTo(d.parentNode.parentNode,{top:parseInt(D.win.height/2)});z(w,{srcuid:b.data.srcuid||"",page:"1",cid:b.data.cid||""},function(){a.removeNode(t)})}function x(h){h=h||{};if(!h.data){var i=a.fixEvent();h.data=a.queryToJson(i.target.getAttribute("action-data"))}c=q[h.data.cid].editor;c.doms.textEl.focus();if(!scope.loginKit().isLogin)w(function(){location.reload()});else{if(scope.$passport!=""){a.comp.widget.comment.login.open();return}var j=r[h.data.mid+"_"+h.data.cid].data,k=c.getValue(),l=f(k),m=k.match(u);if(l>d||l===0||m&&a.trim(m[2])==""||k==o){g(c.doms.textEl);return}var n={appkey:scope.appkey||0,refer:scope.refer||"",shorturl:scope.short_url||"",longurl:scope.long_url||"",content:encodeURIComponent(k||""),issync:c.isSendWB(),language:scope.language||"zh_cn",ralateuid:j.ralateuid||"",uname:j.uname||"",srcuid:j.srcuid||"",mid:j.mid||"",cid:j.cid||""};c.setBtnStatus('<em class="WB_loadingMini"></em>'+b("#L{回复中}"),"WB_btn_replyIng"+b(" #L{WB_cn}"));var p=e.getTrans("comment",{onComplete:function(d){if(d.code==="A00006"){c.showSuccess(b("#L{回复成功！}"));var e=document.createElement("div");e.innserHTML=d.html;var f=c.doms.textEl,g=a.kit.dom.parentElementBy(f,document.body,function(a){if(a.tagName.toLowerCase()=="blockquote")return!0}),h=a.kit.dom.firstChild(a.core.dom.prev(g));h.innerHTML=b("#L{回复}(")+(1*h.innerHTML.replace(/\D/g,"")+1)+")";var i=a.kit.dom.lastChild(g);i!=null&&i.className=="wc_list child_list"?a.insertHTML(i,d.html,"afterbegin"):a.insertHTML(g,'<div class="wc_list child_list" isreal="false">'+d.html+"</div>","afterend");a.comp.widget.comment.resize();a.core.util.scrollTo(g.parentNode)}else c.showError(d.msg||b("#L{回复失败，请重试！}"));c.setBtnStatus(b("#L{回复}"),"WB_btn_reply"+b(" #L{WB_cn}"))},onFail:function(a){}});p.request(n);return!1}}function w(b){var c=a.common.widget.login({vsrc:"app_cmtbox",appsrc:scope.appsrc});typeof b=="function"&&a.custEvent.add(c,"login",function(){b()});c.showLogin()}var b=a.kit.extra.language,c,d=140,e=a.common.trans.comment,f=a.common.editor.getLength,g=a.common.editor.flashContent,h,i=scope.loginKit().uid,j,k=b('<div class="WB_tips_mini" node-type="loginOuter"><span class="WB_tipS_warn"></span>#L{请登录后回复评论。}<a href="#" action-type="login" onclick="return false;">#L{立即登录}</a></div>'),l=b('<div class="WB_tips_mini" node-type="loginOuter"><span class="WB_tipS_warn"></span>#L{该帐号尚未开通微博，开通后才能发表评论。}<a href="#" action-type="open" onclick="return false;" target="_blank">&gt;#L{立即开通}</a></div>'),m=b('<div class="pub_area clearfix" node-type="outer"><div class="wbavatar">'+(i?'<a href="http://weibo.com/u/'+i+'" '+(/\/0\/50\/0\/1/.test(scope.icon)?'onclick="return false;" action-type="open"':'target="_blank"')+'><img src="'+scope.icon+'" node-type="pic" /></a>':'<a href="#" onclick="return false;" action-type="login"><img src="'+scope.icon+'" node-type="pic" /></a>')+"</div>"+'<div class="wb_cmR wbPubbox" node-type="publisher">'+'<div class="wb_counter">#L{还可以输入}<em class="WB_num" node-type="wordNum">140</em>#L{字}</div>'+'<div class="WB_textarea_auto" node-type="container">'+'<div class="WB_send_stat" node-type="tips" style="display:none;">'+'<span class="WB_tipB_err"></span><span class="WB_icon_txt">#L{评论失败，请重试！}</span>'+"</div>"+'<textarea class="textarea_inner" node-type="textEl" action-data="###data###"></textarea>'+"</div>"+'<div class="WB_pubBoxPlus clearfix">'+'<div class="WB_Plus_zone clearfix" node-type="widget">'+'<a href="#" onclick="return false;" node-type="face" class="WB_Aemoticons"><span class="WB_icon"></span><span class="WB_icon_txt">#L{表情}</span></a>'+'<span class="WB_wordPlus"><label><input type="checkbox" class="WB_checkbox" node-type="sendWB" checked="checked" />#L{同步到微博}</label></span>'+"</div>"+'<div class="WB_Plus_btn">'+'<a href="#" onclick="return false;" title="#L{回复}" class="WB_btn_reply_dis" node-type="sendBtn" action-type="sendBtn" action-data="###data###">#L{回复}</a>'+"</div>"+"</div>"+"</div>"+"</div>"),n=b("#L{加载失败}"),o=b("#L{顺便说点什么吧……}"),p=0,q={},r={},s,t,u=new RegExp(["^",b("#L{回复}"),"@([^:]*):(.*)"].join("")),v;return function(b){var c={};s=b;var d=function(){e()},e=function(){j=a.core.evt.delegatedEvent(b);j.add("reply","click",y);j.add("sendBtn","click",x);j.add("reply_back","click",C);j.add("page","click",D);j.add("jinyan","click",E);j.add("quxiao","click",F);j.add("pingbi","click",J);j.add("huifu","click",I);j.add("load_more","click",a.comp.widget.comment.loadmore)},f=function(){};d();c.destroy=f;return c}});
STK.register("comp.widget.comment.msg",function(a){function z(a,b){scope.message_default_text&&(b=b||decodeURIComponent("\n"+scope.message_default_text));q[a.data.uid].API.reset();q[a.data.uid].API.insertText(b);q[a.data.uid].API.focus(0,0)}function y(b){var d=b.el,e=d.parentNode,f,g,h=e.getAttribute("show"),i="";if(h){e.removeAttribute("show");a.removeNode(a.sizzle("blockquote.commReply",e.parentNode)[0]);if(q&&q[b.data.uid]){q[b.data.uid].desotry&&q[b.data.uid].desotry();delete q[b.data.uid]}var j=a.sizzle("div[isreal=false]",d.parentNode.parentNode);for(var n=0,o=j.length;n<o;n++)a.removeNode(j[n]);a.comp.widget.comment.resize();if(h==2)return}e.setAttribute("show",2);var p=a.C("blockquote"),r=a.builder(m.replace(/###data###/g,"uid="+b.data.uid)),s;g=r.list.outer[0];p.className="commReply";if(!scope.loginKit().isLogin){s=a.builder(k);f=s.list.loginOuter[0];p.appendChild(f)}else if(scope.$passport!=""){s=a.builder(l);f=s.list.loginOuter[0];p.appendChild(f)}p.appendChild(g);a.insertAfter(p,e);c=a.comp.widget.comment.editor(r.list.publisher[0],{saveword:!1});q[b.data.uid]=c.editor;q[b.data.uid].editor=c;z(b,i);a.core.evt.hotKey.add(c.doms.textEl,"ctrl+Enter",x);g.style.borderBottom="none";a.comp.widget.comment.resize();var t=a.core.util.pageSize();a.core.util.scrollTo(d.parentNode.parentNode,{top:parseInt(t.win.height/2)})}function x(h){h=h||{};if(!h.data){var i=a.fixEvent();h.data=a.queryToJson(i.target.getAttribute("action-data"))}c=q[h.data.uid].editor;c.doms.textEl.focus();if(!scope.loginKit().isLogin)w(function(){location.reload()});else{if(scope.$passport!=""){a.comp.widget.comment.login.open();return}var j=c.getValue(),k=f(j),l=j.match(u);if(k>d||k===0||l&&a.trim(l[2])==""||j==o){g(c.doms.textEl);return}var m={recv_uid:h.data.uid||0,text:j||""};c.setBtnStatus('<em class="WB_loadingMini"></em>'+b("#L{发私信中}"),"WB_btn_sendIng");var n=e.getTrans("message",{onComplete:function(a){a.code==="100000"?c.showSuccess(b("#L{发私信成功！}")):c.showError(a.msg||b("#L{发私信失败，请重试！}"));c.setBtnStatus(b("#L{发私信}"),"WB_btn_send")},onFail:function(a){}});n.request(m);return!1}}function w(b){var c=a.common.widget.login({vsrc:"app_cmtbox",appsrc:scope.appsrc});typeof b=="function"&&a.custEvent.add(c,"login",function(){b()});c.showLogin()}var b=a.kit.extra.language,c,d=300,e=a.common.trans.comment,f=a.common.editor.getLength,g=a.common.editor.flashContent,h,i=scope.loginKit().uid,j,k=b('<div class="WB_tips_mini" node-type="loginOuter"><span class="WB_tipS_warn"></span>#L{请登录后私信(Ta)。}<a href="#" action-type="login" onclick="return false;">#L{立即登录}</a></div>'),l=b('<div class="WB_tips_mini" node-type="loginOuter"><span class="WB_tipS_warn"></span>#L{该帐号尚未开通微博，开通后才能私信(Ta)。}<a href="#" action-type="open" onclick="return false;" target="_blank">&gt;#L{立即开通}</a></div>'),m=b('<div class="pub_area clearfix" node-type="outer"><div class="wbavatar">'+(i?'<a href="http://weibo.com/u/'+i+'" '+(/\/0\/50\/0\/1/.test(scope.icon)?'onclick="return false;" action-type="open"':'target="_blank"')+'><img src="'+scope.icon+'" node-type="pic" /></a>':'<a href="#" onclick="return false;" action-type="login"><img src="'+scope.icon+'" node-type="pic" /></a>')+"</div>"+'<div class="wb_cmR wbPubbox" node-type="publisher">'+'<div class="wb_counter">#L{还可以输入}<em class="WB_num" node-type="wordNum">300</em>#L{字}</div>'+'<div class="WB_textarea_auto" node-type="container">'+'<div class="WB_send_stat" node-type="tips" style="display:none;">'+'<span class="WB_tipB_err"></span><span class="WB_icon_txt">#L{私信(Ta)失败，请重试！}</span>'+"</div>"+'<textarea class="textarea_inner" node-type="textEl" action-data="###data###"></textarea>'+"</div>"+'<div class="WB_pubBoxPlus clearfix">'+'<div class="WB_Plus_zone clearfix" node-type="widget">'+'<a href="#" onclick="return false;" node-type="face" class="WB_Aemoticons"><span class="WB_icon"></span><span class="WB_icon_txt">#L{表情}</span></a>'+"</div>"+'<div class="WB_Plus_btn">'+'<a href="#" onclick="return false;" title="#L{发私信}" class="WB_btn_send_dis #L{WB_cn}" node-type="sendBtn" action-type="sendBtn" action-data="###data###">#L{发私信}</a>'+"</div>"+"</div>"+"</div>"+"</div>"),n=b("#L{加载失败}"),o=b("#L{顺便说点什么吧……}"),p=0,q={},r={},s,t,u=new RegExp(["^",b("#L{回复}"),"@([^:]*):(.*)"].join("")),v;return function(b){var c={};s=b;var d=function(){e()},e=function(){j=a.core.evt.delegatedEvent(b);j.add("message","click",y);j.add("sendBtn","click",x)},f=function(){};d();c.destroy=f;return c}});
STK.register("comp.widget.comment.login",function(a){function k(){var a=scope.refer||scope.$refer||conf.refer,b=scope.loginKit().uid||"",c=scope.appkey||$CONFIG.$appkey||$CONFIG.appkey||0,d=7,e="http://rs.sinajs.cn/z.gif?uid="+b+"&refer="+a+"&url="+encodeURIComponent(document.referrer)+"&cat="+d+"&login="+(scope.loginKit().isLogin?1:0)+"&rnd="+ +(new Date),f=new Image;f.src=e;f=null}function j(a){var b="http://weibo.com/signup/full_info.php?appsrc=4uyaHS&backurl=http%3A%2F%2Fwidget.weibo.com%2Fstaticjs%2FloginProxy.html&showlogo=0&diy=&from=zw&c=&refer="+(scope.refer||"http%3A%2F%2F"),c=window.open(b,"miniblog_login",["toolbar=0,status=0,resizable=1,width=950,height=600,left=",(screen.width-660)/2,",top=",(screen.height-660)/2].join(""));try{c.focus()}catch(d){}}function i(a){window.location.href="http://weibo.com/logout.php?backurl="+encodeURIComponent(window.location.href)}function h(b){window.App=window.App||{};App.loginBackUrlCallBack=function(){scope.postLogin=1;a.common.widget.log({vsrc:"app_commentbox",step:2});b&&typeof b=="function"?b():location.reload()};var c="http://service.weibo.com/reg/loginindex.php?regbackurl=http%3A%2F%2Fweibo.com&backurl=http%3A%2F%2F"+location.host+"%2Fstaticjs%2FloginProxy.html&vsrc=app_cmtbox&appsrc="+scope.appsrc+"&showlogo=0&rnd="+(new Date).valueOf();scope.$spr&&(c+="&c="+scope.$spr);typeof scope.refer!="undefined"&&(c+="&refer="+scope.refer);a.common.widget.log({vsrc:"app_commentbox"});var d=window.open(c,"miniblog_login",["toolbar=0,status=0,resizable=1,width=660,height=400,left=",(screen.width-660)/2,",top=",(screen.height-500)/2].join(""));try{d.focus()}catch(e){}}function g(a){window.open("http://weibo.com/signup/signup.php?c="+encodeURIComponent(window.location.href)+"&lang=zh-cn","regist")}function f(a){if(scope.is_show_message==1){var e=c.getTrans("getmsg",{onComplete:function(c){d=b('<span class="wline">|</span><a href="http://www.weibo.com/messages" target="_blank" class="lgout_link">#L{私信}('+c.data.dm+")</a>"+'<span class="wline">|</span><a href="http://www.weibo.com/notesboard" target="_blank" class="lgout_link">#L{未关注人私信}('+c.data.msgbox+")</a>");a.login_info.innerHTML=a.login_info.innerHTML.replace("<span></span>",d)}});e.request({})}if(scope.loginKit().isLogin){var f=c.getTrans("getuserinfo",{onComplete:function(c){var e;c.adminFlag&&(scope.addminFlag=c.addminFlag);c.code=parseInt(c.code);if(c.code===0||c.code===-1){var f=c.nick||"",g=scope.loginKit().uid;scope.$uid=g;scope.$passport="";a.login_info&&(a.login_info.innerHTML=b('<span class="WB_logo16a">#L{微博}</span><a href="http://weibo.com/u/'+g+'" '+(c.code===-1?'action-type="open" onclick="return false;"':' target="_blank"')+">"+f+"</a>"+d+'<span class="lgHover"><span class="wline">|</span><a href="#" onlick="return false;" class="lgout_link" action-type="logout">#L{退出}</a></span>'));a.login_pic&&c.userpic!=null&&(a.login_pic.innerHTML='<a target="_blank" href="http://weibo.com/u/'+g+'"><img title="'+f+'" alt="'+f+'" src="'+c.userpic+'"></a>')}if(c.code===-1){scope.$passport=scope.loginKit().uid;a.login_tips&&(a.login_tips.style.display="");e='<a href="http://weibo.com/u/'+g+'" action-type="open" onclick="return false;"><img title="'+f+'" alt="'+f+'" src="http://tp1.sinaimg.cn/0/50/0/1"></a>';a.login_pic&&e&&(a.login_pic.innerHTML=e)}else a.login_tips&&(a.login_tips.style.display="none")}});f.request({appkey:scope.appkey||"0"})}else if(a.login_info&&/action-type="login"/.test(a.login_info.innerHTML)==!1){a.login_info.innerHTML=b('<span class="WB_logo16a">#L{微博}</span><a href="#" onclick="return false;" action-type="login" class="lg_link">#L{登录}</a><span class="wline">|</span><a href="#" onclick="return false;" action-type="regist" class="rg_link">#L{注册}</a>');var g='<a href="#" action-type="regist" onclick="return false;"><img title="" alt="" src="http://tp1.sinaimg.cn/0/50/0/1"></a>';a.login_pic&&g&&(a.login_pic.innerHTML=g)}}function e(){var a=location.href.split("#")[0];a=a.replace(/&?dpc=\d+/g,"")+"&adminFlag=1";location.href=a}var b=a.kit.extra.language,c=a.common.trans.comment,d="<span></span>",l={reload:e,getUserInfo:f,regist:g,login:h,logout:i,open:j,log:k};return l});
STK.register("comp.widget.comment.admin",function(a){var b=a.kit.extra.language,c=a.common.trans.comment,d=a.comp.widget.comment.login,e,f,g;return function(b){function j(){}function i(){g=a.core.evt.delegatedEvent(b);g.add("regist","click",d.regist);g.add("login","click",d.login);g.add("logout","click",d.logout);g.add("open","click",d.open)}function h(){e=b;f=a.kit.dom.parseDOM(a.builder(b).list);d.getUserInfo(f);i();d.log()}var c;h();c={destroy:j};return c}});
STK.register("comp.widget.comment.loadmore",function(a){function n(){c.className="WB_loadingLine";c.innerHTML='<span class="WB_tipS_err"></span><span class="WB_icon_txt">'+f+"</span>"}function m(){c.className="WB_loadingLine";c.innerHTML='<span class="WB_loadingMini"></span><span class="WB_icon_txt">'+e+"</span>"}function l(){c.className="WB_loadingLine WB_loadingNow";c.innerHTML=b("<em>#L{更多}</em>")}function k(){c.className="WB_noContent";c.innerHTML=d;c.removeAttribute("action-type")}function j(b){c=b.el;var d={since_id:scope.since_id,adminFlag:scope.adminFlag,appkey:scope.appkey?scope.appkey:0,short_url:scope.short_url,language:scope.language},e=g.getTrans("loadmore",{onComplete:function(b){if(b.code==="A00006"){i(b.html);a.comp.widget.comment.resize();scope.since_id=b.since_id;l()}else b.code=="A00008"?k():n()}});m();e.request(d)}function i(b){if(c){h==null&&(h=a.core.dom.prev(c));a.insertHTML(h,b,"beforeend")}}var b=a.kit.extra.language,c,d=b("#L{没有更早的评论了}"),e=b("#L{正在加载}"),f=b("#L{加载失败，请重试}"),g=a.common.trans.comment,h;return j});
STK.register("common.xdomain",function(a){var b=window,c=document,d=0;return function(a,e){var f={};typeof e!="function"&&(e=function(){});var g=function(){var f="";if(b.postMessage){if(b.addEventListener)b.addEventListener("message",function(a){e.call(b,a.data)},!1);else if(b.attachEvent)b.attachEvent("onmessage",function(a){e.call(b,a.data)});else throw"[common.xDomain] addEventListener error";return function(b){a.postMessage(b,"*")}}setInterval(function(){if(b.name!==f){f=b.name;e.call(b,f)}},50);return function(b){a.name=+(new Date)+d++ +"^"+c.domain+"&"+escape(b)}};return g()}});
STK.register("comp.widget.comment.xdomain",function(a){var b=0;return function(c){var d={setSize:a.common.xdomain(c)},e=function(){c=c||parent;var e={page:{width:document.body.clientWidth,height:document.body.clientHeight}};e=a.jsonToQuery(e.page);setInterval(function(){b<4&&d.setSize(e);b++},200)};d.resize=function(c){if(b<4)setTimeout(function(){d.resize(c)},200);else{var e=c||{page:{width:document.body.clientWidth,height:document.body.clientHeight}};e=a.jsonToQuery(e);d.setSize(e)}};var f=function(){};d.destroy=f;e();return d}});
STK.register("common.diy.addStyle",function(a){var b=!1;window.attachEvent&&window.attachEvent("onload",function(){b=!0});return function(c){function d(){var b=document.createElement("style");b.type="text/css";if(a.IE)b.styleSheet.cssText=c;else{var d=document.createDocumentFragment();d.appendChild(document.createTextNode(c));b.appendChild(d)}document.getElementsByTagName("head")[0].appendChild(b)}!a.IE||b?d():window.attachEvent("onload",function(){b=!0;d()})}});
STK.register("comp.widget.comment.style",function(a){var b=a.common.diy.addStyle,c=location.href,d=function(){var a="",d=/colordiy=(\d+)/.test(c)?RegExp.$1:0,e=/color=([A-Fa-f\d,]+)/.test(c)?RegExp.$1:"";if(e&&d==1){e=e.split(",");e[0]&&(a+=".weiboComments .wc_box {border-color:#"+e[0]+";}");e[1]&&(a+="\n .weiboComments{background-color:#"+e[1]+";}");e[2]&&(a+="\n .weiboComments{color:#"+e[2]+";}");e[3]&&(a+="\n .weiboComments a{color:#"+e[3]+";}");e[4]&&(a+="\n .weiboComments .wc_list_nod, .weiboComments .list_title, .weiboComments .wbPubbox, .weiboComments .commReply .pub_area{border-color:#"+e[4]+";}");e[5]&&(a+="\n .weiboComments .WB_pages .page_btn, .weiboComments .WB_loadingLine{background-color:#"+e[5]+";}")}var f=/border=(\d+)/.test(c)?RegExp.$1:1;f==0&&(a+="\n.weiboComments .wc_box{border:none}");a&&b(a)};return function(a){d()}});
STK.register("comp.widget.comment.init",function(a){function m(b){var c=a.common.widget.login({vsrc:"app_cmtbox",appsrc:scope.appsrc});typeof b=="function"&&a.custEvent.add(c,"login",function(){b()});c.showLogin()}var b=a.kit.extra.language,c=a.common.editor.getLength,d=a.common.editor.flashContent,e=a.comp.widget.comment,f,g=a.common.trans.comment,h=140,i,j,k,l=b("#L{顺便说点什么吧……}"),n=function(e,f){a.stopEvent(e);var j=k.getValue(),m=c(j);if(!scope.loginKit().isLogin)a.comp.widget.comment.login.login();else{if(scope.$passport!=""){a.comp.widget.comment.login.open();return}k.doms.textEl.focus();if(m>h||m===0||j==l){d(k.doms.textEl);return}var n={ralateuid:scope.ralateuid||"",appkey:scope.appkey||0,refer:scope.refer||"",shorturl:scope.short_url||"",longurl:scope.long_url||"",content:encodeURIComponent(j||""),issync:k.isSendWB(),language:scope.language||"zh_cn"};k.setBtnStatus('<em class="WB_loadingMini"></em>'+b("#L{评论中}"),"WB_btn_commentIng"+b(" #L{WB_cn}"));var o=g.getTrans("publisher",{onComplete:function(c){if(c.code==="A00006"){k.showSuccess();var d=a.kit.dom.firstChild(i.comment_list),e=a.core.dom.next(d);if(e.className=="wc_list no_comments"){e.className="wc_list";e.innerHTML=c.html}else a.insertHTML(e,c.html,"afterbegin");d.innerHTML=d.innerHTML.replace(/\D/g,"")*1+1+b("#L{条评论}");i.wordNum.innerHTML="140";i.textEl.value="";a.core.util.storage.del("publish_word");a.comp.widget.comment.resize()}else k.showError(c.msg);setTimeout(function(){f&&f()},3e3)}});o.request(n);return!1}};return function(b){var c={},d=function(){e.style();g();m();j=e.xdomain(window.parent||window.self);h();l()},g=function(){i=a.builder(b).list;i=a.kit.dom.parseDOM(i)},h=function(){a.common.channel.page.register("resize",j.setSize)},l=function(){var c=a.E("feedList");if(!c){var d=a.pageSize();d.page.height=a.core.dom.getSize(b).height;var e=d.page;j.resize(e)}},m=function(){k=new e.editor(i.publisher,{saveword:!0});i.sendWB.checked=!0;a.addEvent(k.doms.sendBtn,"click",n);a.core.evt.hotKey.add(k.doms.textEl,"ctrl+Enter",n);e.reply(i.comment_list);e.msg(i.comment_list);f=e.admin(b)},o=function(){a.removeEvent(k.doms.sendBtn,"click",n);a.core.evt.hotKey.remove(k.doms.textEl,"ctrl+Enter",n);f.destroy();delete k.doms;k=null};d();c.destroy=o;return c}});
STK.pageletM.register("pl.widget.comment",function(a){try{var b=a.E("pl_widget_comment"),c=a.comp.widget.comment.init(b);return c}catch(d){}});
STK.pageletM.start();
